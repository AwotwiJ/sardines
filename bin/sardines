#!/usr/bin/env node
var cli = require("optimist").
usage('Usage: $0 [include] -e [entry] -o [output] -p [port] -d -s').
default("d", process.cwd()).
default("p", 8080).
default("m", "shrinkwrap").
alias("m", "method").
alias("d", "directory").
alias("h", "help").
alias("p", "port").
alias("s", "server").
describe("s", "run the http server").
describe("d", "public directory for http server");


var fs = require("fs");

var argv = cli.argv;

if(argv.help) {
	cli.showHelp();
	process.exit();
}


function fullPath(path) {
	return path.substr(0, 1) != "/" ? argv.d + "/" + path : path;
}

if(argv.server) {
	var express = require("express");
	var server = express.createServer();
	server.use(require("../").middleware({
		directory: argv.d
	}));
	// server.use(express.static(argv.d));
	server.listen(argv.p);
} else {
	require("../")[argv.m]({
		entry: fullPath(argv.e),
		directory: argv.d
	}, function(err, content) {
		fs.writeFile(fullPath(argv.o), content);
	})
}